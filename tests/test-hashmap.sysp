;; test-hashmap.sysp â€” hash map CRUD, merge, keys/vals, contains

(defn main () :int
  ;; Basic creation and set/get
  (let-mut m (HashMap "x" 10 "y" 20 "z" 30))
  (println (hash-get m "x"))   ; 10
  (println (hash-get m "y"))   ; 20
  (println (hash-get m "z"))   ; 30
  (println (hash-len m))       ; 3

  ;; Update existing key
  (hash-set! m "x" 99)
  (println (hash-get m "x"))  ; 99

  ;; has/contains
  (println (hash-has? m "x")) ; true
  (println (hash-has? m "w")) ; false
  (println (contains? m "y")) ; true

  ;; Delete
  (hash-del! m "y")
  (println (hash-len m))       ; 2
  (println (hash-has? m "y"))  ; false

  ;; Clojure aliases
  (assoc! m "a" 42)
  (println (hash-get m "a"))   ; 42
  (dissoc! m "a")
  (println (hash-has? m "a"))  ; false

  ;; Integer keys
  (let-mut m2 (HashMap 1 100 2 200 3 300))
  (println (hash-get m2 1))   ; 100
  (println (hash-get m2 3))   ; 300
  (hash-set! m2 4 400)
  (println (hash-len m2))     ; 4

  ;; keys and vals
  (let-mut m3 (HashMap "a" 1 "b" 2))
  (let ks (hash-keys m3))
  (let vs (hash-vals m3))
  (println (vector-len ks))   ; 2
  (println (vector-len vs))   ; 2

  ;; merge
  (let-mut m4 (HashMap "x" 1))
  (let-mut m5 (HashMap "y" 2 "z" 3))
  (merge! m4 m5)
  (println (hash-len m4))     ; 3
  (println (hash-get m4 "y")) ; 2
  (println (hash-get m4 "z")) ; 3

  ;; for-each on hash maps: [k v m]
  (let-mut m6 (HashMap 1 10 2 20 3 30))
  (let-mut sum 0)
  (for-each [k v m6]
    (set! sum (+ sum v)))
  (println sum)                      ; 60

  ;; for-each with string keys
  (let-mut m7 (HashMap "a" 1 "b" 2))
  (for-each [k v m7]
    (print k)
    (print "=")
    (println v))
  ;; a=1  (or b=2 first, order is unspecified)
  ;; b=2

  0)
