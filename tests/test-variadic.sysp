;; test-variadic.sysp â€” variadic arithmetic, chained comparisons, bare enums, new string ops

(enum Dir North, South, East, West)

(defn main () :int
  ;; Variadic addition
  (println (+ 1 2 3))          ; 6
  (println (+ 1 2 3 4 5))     ; 15

  ;; Variadic multiplication
  (println (* 2 3 4))          ; 24

  ;; Variadic subtraction (left fold)
  (println (- 10 3 2 1))       ; 4

  ;; Mixed with floats
  (println (+ 1.0 2.0 3.0))   ; 6.000000

  ;; Binary still works
  (println (+ 1 2))            ; 3
  (println (- 5 3))            ; 2

  ;; Unary minus still works
  (println (- 42))             ; -42

  ;; Bare enum
  (let d North)
  (println (== d North))       ; true
  (println (== d South))       ; false

  ;; Variadic in expression context
  (let x (+ 1 2 3 4))
  (println x)                  ; 10

  ;; Nested variadic
  (println (+ (* 2 3 4) (- 10 3 2)))  ; 24 + 5 = 29

  ;; Chained comparisons
  (println (< 1 2 3))          ; true
  (println (< 1 3 2))          ; false
  (println (<= 1 1 2 3))      ; true
  (println (> 3 2 1))          ; true
  (println (== 5 5 5))         ; true
  (println (!= 1 2 3))         ; true (1!=2 && 2!=3)

  ;; set! on hash-get
  (let-mut m (hash-map "a" 1 "b" 2))
  (set! (hash-get m "a") 99)
  (println (hash-get m "a"))   ; 99

  ;; partial
  (let add5 (partial + 5))
  (println (add5 3))           ; 8
  (println (add5 10))          ; 15

  ;; New string builtins
  (println (str-starts? "hello world" "hello"))    ; true
  (println (str-starts? "hello world" "world"))    ; false
  (println (str-ends? "hello world" "world"))      ; true
  (println (str-ends? "hello world" "hello"))      ; false
  (println (str-trim "  hello  "))                 ; hello
  (println (str-replace "foo bar foo" "foo" "baz")) ; baz bar baz

  ;; str-join
  (let-mut words (vector "a" "b" "c"))
  (println (str-join words ", "))                   ; a, b, c
  (println (str-join words "-"))                    ; a-b-c

  0)
